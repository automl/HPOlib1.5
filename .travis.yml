language: python
dist: bionic

cache:
  apt: true
  directories:
    - $HOME/.cache/pip
    - $HOME/.hpolib/
  pip: true

sudo: false

before_cache:
  - rm -f $HOME/.cache/pip/log/debug.log

env:
  matrix:
    - DISTRIB="conda" PYTHON_VERSION=3.4
    - DISTRIB="conda" PYTHON_VERSION=3.5
    - DISTRIB="conda" PYTHON_VERSION=3.6
    - DISTRIB="conda" PYTHON_VERSION=3.7 DOCPUSH="true"

before_install:
  - sudo apt-get install libatlas-base-dev
  - sudo apt-get install liblapack-dev
  - sudo apt-get install gfortran
  - sudo apt-get install build-essential
  - sudo apt-get install swig

install:
  - source ci_scripts/install.sh

# command to run tests, e.g. python setup.py test
script:
  # - nosetests -sv --with-coverage --cover-package=hpolib
  - source ci_scripts/create_doc.sh $TRAVIS_BRANCH "doc_result"

after_deploy:
  - nosetests -sv --with-coverage --cover-package=hpolib

deploy:
  provider: pages
  skip-cleanup: true
  github-token: $HPOlib2
  keep-history: true
  committer-from-gh: true
  on:
    all_branches: true
    condition: $doc_result = "success"
  local_dir: doc/$TRAVIS_BRANCH
